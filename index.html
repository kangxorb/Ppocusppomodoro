<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸</title>
    <!-- Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ë° ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        /* ë‹¤í¬ ëª¨ë“œ ê¸°ë³¸ ë°°ê²½/í…ìŠ¤íŠ¸ ìƒ‰ìƒ (Tailwindê°€ ë¡œë“œë˜ê¸° ì „ ê¹œë°•ì„ ë°©ì§€) */
        :root {
            color-scheme: light dark;
        }
        /* ë²„íŠ¼ í¬ì»¤ìŠ¤ ì‹œ ê·¸ë¦¼ì íš¨ê³¼ ê°œì„  */
        button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
        }
        /* ì…ë ¥ì°½ í¬ì»¤ìŠ¤ */
        input:focus {
            outline: none;
            border-color: #3B82F6; /* blue-500 */
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        
        /* ì„¤ì • ëª¨ë‹¬ìš© ìŠ¤íƒ€ì¼ */
        #settings-modal {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }

        /* ì›í˜• ì§„í–‰ë°” ìŠ¤íƒ€ì¼ */
        .progress-ring__circle {
            transition: stroke-dasharray 0.9s ease-out; /* ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ */
            transform: rotate(-90deg); /* ì›ì˜ ì‹œì‘ì ì„ 12ì‹œ ë°©í–¥ìœ¼ë¡œ */
            transform-origin: 50% 50%; /* ì¤‘ì•™ ê¸°ì¤€ íšŒì „ */
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 overflow-hidden">

    <div id="app" class="relative flex flex-col items-center justify-center min-h-screen p-4 w-full max-w-md mx-auto">
        
        <!-- ìƒë‹¨ í—¤ë” (ìƒíƒœ í‘œì‹œ ë° ì„¤ì • ë²„íŠ¼ ì •ë ¬) -->
        <div class="relative w-full max-w-xs flex justify-center items-center mb-2">
            <!-- ìƒíƒœ í‘œì‹œ -->
            <div id="status" class="text-xl font-semibold text-blue-500 dark:text-blue-400">
                Ppocus
            </div>

            <!-- ì„¤ì • ë²„íŠ¼ -->
            <button id="settings-btn" class="absolute right-0 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>
        
        <!-- í˜„ì¬ ì‘ì—… ì…ë ¥ -->
        <input id="task-input" type="text" placeholder="ë¬´ì—‡ì— ì§‘ì¤‘í•˜ê³  ìˆë‚˜ìš”?" class="w-full max-w-xs text-center bg-gray-100 dark:bg-gray-700 border border-transparent rounded-lg px-3 py-2 text-sm focus:border-blue-500 transition-all mb-4">

        <!-- [FIXED] íƒ€ì´ë¨¸ ë° ì›í˜• ì§„í–‰ë°” HTML ëˆ„ë½ ë¶€ë¶„ ì¶”ê°€ -->
        <div class="relative w-48 h-48 flex items-center justify-center mb-4">
            <svg class="w-full h-full absolute" viewBox="0 0 100 100">
                <!-- ë°°ê²½ ì› -->
                <circle cx="50" cy="50" r="45" fill="none" stroke="currentColor" class="text-gray-200 dark:text-gray-700" stroke-width="10"></circle>
                <!-- ì§„í–‰ ì› (ì¤‘ë³µ class ìˆ˜ì •) -->
                <circle id="progress-circle" class="progress-ring__circle" cx="50" cy="50" r="45" fill="none" stroke="currentColor" stroke-width="10" stroke-dasharray="0, 283"></circle>
            </svg>
            <div id="timer" class="absolute text-5xl font-bold">
                25:00
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ --><div class="flex space-x-4 mb-6">
            <button id="start-pause-btn" class="w-24 bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all transform hover:scale-105">
                Start
            </button>
            <button id="reset-btn" class="w-24 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-100 font-bold py-3 px-4 rounded-lg shadow-md transition-all transform hover:scale-105">
                Reset
            </button>
        </div>

        <!-- ë½€ëª¨ë„ë¡œ ì¹´ìš´í„° --><div id="counter" class="text-lg">
            ì˜¤ëŠ˜ ì™„ë£Œ: <span id="count-display" class="font-bold">ğŸ… x 0</span>
        </div>

        <!-- ì„¤ì • ëª¨ë‹¬ --><div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center p-4 opacity-0 -translate-y-10 pointer-events-none">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm">
                <h2 class="text-2xl font-bold mb-6 text-center">ì„¤ì •</h2>
                
                <div class="mb-4">
                    <label for="focus-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì§‘ì¤‘ ì‹œê°„ (ë¶„)</label>
                    <input type="number" id="focus-time" min="1" max="60" class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:border-blue-500 transition-all">
                </div>
                
                <div class="mb-6">
                    <label for="break-time" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">íœ´ì‹ ì‹œê°„ (ë¶„)</label>
                    <input type="number" id="break-time" min="1" max="30" class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:border-blue-500 transition-all">
                </div>
                
                <button id="save-settings-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">
                    ì €ì¥
                </button>
                <button id="close-settings-btn" class="w-full mt-2 text-gray-600 dark:text-gray-400 hover:underline">
                    ë‹«ê¸°
                </button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ìš”ì†Œ ---
            const timerDisplay = document.getElementById('timer');
            const statusDisplay = document.getElementById('status');
            const taskInput = document.getElementById('task-input');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const resetBtn = document.getElementById('reset-btn');
            const countDisplay = document.getElementById('count-display');
            const progressCircle = document.getElementById('progress-circle'); // SVG ì§„í–‰ ì›
            const circumference = 2 * Math.PI * 45; // ì›ì˜ ë‘˜ë ˆ (r=45)

            // [FIX] ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œì ì— ìš”ì†Œë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜ ë°©ì§€
            // ìŠ¤í¬ë¦½íŠ¸ê°€ DOM ìš”ì†Œë¥¼ ì°¾ëŠ” ì‹œì ì— HTMLì´ ëª¨ë‘ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
            // DOMContentLoadedë¡œ ì´ë¯¸ ê°ì‹¸ì ¸ ìˆìœ¼ë¯€ë¡œ, null ì²´í¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë°©ì–´ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
            if (!progressCircle || !timerDisplay) {
                console.error('í•„ìˆ˜ HTML ìš”ì†Œ(timer, progress-circle)ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return; // í•„ìˆ˜ ìš”ì†Œê°€ ì—†ìœ¼ë©´ ìŠ¤í¬ë¦½íŠ¸ ì¤‘ë‹¨
            }

            progressCircle.style.strokeDasharray = `${circumference} ${circumference}`; // ì´ˆê¸° ë‘˜ë ˆ ì„¤ì •
            progressCircle.style.strokeDashoffset = circumference; // ì´ˆê¸°ì—ëŠ” ì›ì´ ì±„ì›Œì§€ì§€ ì•Šë„ë¡ ì„¤ì •

            // ì„¤ì • ëª¨ë‹¬ DOM
            const settingsBtn = document.getElementById('settings-btn');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsBtn = document.getElementById('close-settings-btn');
            const saveSettingsBtn = document.getElementById('save-settings-btn');
            const focusTimeInput = document.getElementById('focus-time');
            const breakTimeInput = document.getElementById('break-time');

            // --- ìƒíƒœ ë³€ìˆ˜ ---
            let timerInterval = null;
            let isRunning = false;
            let currentMode = 'focus'; // 'focus' or 'break'
            
            // localStorageì—ì„œ ê°’ ë¡œë“œ (ê¸°ë³¸ê°’: 25ë¶„, 5ë¶„)
            let focusTime = parseInt(localStorage.getItem('pomo.focusTime') || '25', 10);
            let breakTime = parseInt(localStorage.getItem('pomo.breakTime') || '5', 10);
            
            let totalTimeForMode = focusTime * 60; // í˜„ì¬ ëª¨ë“œì˜ ì „ì²´ ì‹œê°„ (ì´ˆ)
            let timeLeft = focusTime * 60; // ì´ˆ ë‹¨ìœ„
            let pomodoroCount = 0;
            let lastResetDate = localStorage.getItem('pomo.lastResetDate');

            // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ (ì•Œë¦¼ìŒìš©)
            let audioContext;
            try {
                 audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.warn('Web Audio API is not supported in this browser.');
            }

            // --- í•¨ìˆ˜ ---

            // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸í•˜ì—¬ ì¹´ìš´í„° ì´ˆê¸°í™”
            function checkAndResetCount() {
                const today = new Date().toLocaleDateString();
                if (lastResetDate !== today) {
                    pomodoroCount = 0;
                    lastResetDate = today;
                    localStorage.setItem('pomo.count', '0');
                    localStorage.setItem('pomo.lastResetDate', today);
                } else {
                    pomodoroCount = parseInt(localStorage.getItem('pomo.count') || '0', 10);
                }
                updateCounterDisplay();
            }

            // ì¹´ìš´í„° í‘œì‹œ ì—…ë°ì´íŠ¸
            function updateCounterDisplay() {
                countDisplay.textContent = `ğŸ… x ${pomodoroCount}`;
            }

            // ì›í˜• ì§„í–‰ë°” ì—…ë°ì´íŠ¸
            function updateProgressCircle() {
                // totalTimeForModeëŠ” í˜„ì¬ ëª¨ë“œì˜ ì‹œì‘ ì‹œê°„ (ì´ˆ)
                // timeLeftëŠ” ë‚¨ì€ ì‹œê°„ (ì´ˆ)
                const progress = (totalTimeForMode - timeLeft) / totalTimeForMode; // ì§„í–‰ë¥  (0~1)
                const dashoffset = circumference * (1 - progress); // ì±„ì›Œì§ˆ ë¶€ë¶„
                progressCircle.style.strokeDashoffset = dashoffset;
                
                // ì§„í–‰ë°” ìƒ‰ìƒ ë³€ê²½ (focus: red-500, break: green-500)
                progressCircle.style.stroke = currentMode === 'focus' ? 'rgb(239 68 68)' : 'rgb(34 197 94)'; 
            }


            // íƒ€ì´ë¨¸ í‘œì‹œ ì—…ë°ì´íŠ¸ (MM:SS)
            function updateTimerDisplay() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                const display = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                timerDisplay.textContent = display;
                
                // ë¸Œë¼ìš°ì € íƒ­ ì œëª© ì—…ë°ì´íŠ¸
                const icon = currentMode === 'focus' ? 'ğŸ…' : 'â˜•ï¸';
                document.title = `${icon} ${display} - ${taskInput.value || 'ë½€ëª¨ë„ë¡œ'}`;

                updateProgressCircle(); // ì›í˜• ì§„í–‰ë°” ì—…ë°ì´íŠ¸ í˜¸ì¶œ
            }

            // ì•Œë¦¼ìŒ ì¬ìƒ
            function playAlertSound() {
                if (!audioContext) return;
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.type = 'sine'; // 'sine', 'square', 'sawtooth', 'triangle'
                oscillator.frequency.setValueAtTime(660, audioContext.currentTime); // ì£¼íŒŒìˆ˜ (Hz)
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime); // ë³¼ë¥¨
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3); // 0.3ì´ˆê°„ ì¬ìƒ
            }

            // ëª¨ë“œ ì „í™˜ (Focus <-> Break)
            function switchMode() {
                if (currentMode === 'focus') {
                    currentMode = 'break';
                    totalTimeForMode = breakTime * 60;
                    timeLeft = totalTimeForMode;
                    statusDisplay.textContent = 'â˜•ï¸ Break';
                    statusDisplay.classList.remove('text-blue-500', 'dark:text-blue-400');
                    statusDisplay.classList.add('text-green-500', 'dark:text-green-400');
                    
                    // ì§‘ì¤‘ ì„¸ì…˜ ì™„ë£Œ ì‹œ ì¹´ìš´íŠ¸ ì¦ê°€
                    pomodoroCount++;
                    localStorage.setItem('pomo.count', pomodoroCount);
                    updateCounterDisplay();

                } else {
                    currentMode = 'focus';
                    totalTimeForMode = focusTime * 60;
                    timeLeft = totalTimeForMode;
                    statusDisplay.textContent = 'ğŸ… Focus';
                    statusDisplay.classList.remove('text-green-500', 'dark:text-green-400');
                    statusDisplay.classList.add('text-blue-500', 'dark:text-blue-400');
                }
                updateTimerDisplay();
                playAlertSound();
                
                // ëª¨ë“œ ì „í™˜ í›„ íƒ€ì´ë¨¸ ìë™ ì‹œì‘ (ì„ íƒì )
                // startTimer(); 
                // ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì‹œì‘í•˜ë„ë¡ ì •ì§€ ìƒíƒœë¡œ ë‘¡ë‹ˆë‹¤.
                pauseTimer(); // ëª¨ë“œ ì „í™˜ í›„ ë°”ë¡œ ì‹œì‘í•˜ì§€ ì•Šê³  ì¼ì‹œì •ì§€ ìƒíƒœë¡œ ëŒ€ê¸°
                // updateProgressCircle(); // ìƒˆë¡œìš´ ëª¨ë“œì˜ ì´ˆê¸° ì§„í–‰ë°” ìƒíƒœë¡œ ì„¤ì •
            }

            // ì¹´ìš´íŠ¸ë‹¤ìš´ ë¡œì§
            function countdown() {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    isRunning = false;
                    switchMode();
                }
            }

            // íƒ€ì´ë¨¸ ì‹œì‘
            function startTimer() {
                if (isRunning) return;
                isRunning = true;
                startPauseBtn.textContent = 'Pause';
                startPauseBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600', 'dark:bg-blue-600', 'dark:hover:bg-blue-700');
                startPauseBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600', 'dark:bg-yellow-600', 'dark:hover:bg-yellow-700');
                
                // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™” (ì‚¬ìš©ì ìƒí˜¸ì‘ìš©)
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }

                timerInterval = setInterval(countdown, 1000);
                updateTimerDisplay(); // íƒ­ ì œëª© ì¦‰ì‹œ ë³€ê²½
            }

            // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€
            function pauseTimer() {
                if (!isRunning) return;
                isRunning = false;
                clearInterval(timerInterval);
                timerInterval = null;
                startPauseBtn.textContent = 'Start';
                startPauseBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600', 'dark:bg-yellow-600', 'dark:hover:bg-yellow-700');
                startPauseBtn.classList.add('bg-blue-500', 'hover:bg-blue-600', 'dark:bg-blue-600', 'dark:hover:bg-blue-700');
                document.title = "â¸ ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸";
            }

            // íƒ€ì´ë¨¸ ë¦¬ì…‹
            function resetTimer(confirmReset = true) {
                if (isRunning && confirmReset) {
                    if (!confirm("íƒ€ì´ë¨¸ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        return;
                    }
                }
                
                pauseTimer(); // ì¼ë‹¨ ì •ì§€
                totalTimeForMode = (currentMode === 'focus') ? focusTime * 60 : breakTime * 60;
                timeLeft = totalTimeForMode;
                updateTimerDisplay(); // íƒ€ì´ë¨¸, íƒ­ ì œëª©, ì›í˜• ì§„í–‰ë°” ëª¨ë‘ ì´ˆê¸°í™”
                document.title = "ë½€ëª¨ë„ë¡œ íƒ€ì´ë¨¸";
            }
            
            // ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
            function openSettings() {
                focusTimeInput.value = focusTime;
                breakTimeInput.value = breakTime;
                settingsModal.classList.remove('opacity-0', '-translate-y-10', 'pointer-events-none');
                settingsModal.classList.add('opacity-100', 'translate-y-0');
            }

            // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
            function closeSettings() {
                settingsModal.classList.add('opacity-0', '-translate-y-10', 'pointer-events-none');
                settingsModal.classList.remove('opacity-100', 'translate-y-0');
            }

            // ì„¤ì • ì €ì¥
            function saveSettings() {
                const newFocusTime = parseInt(focusTimeInput.value, 10);
                const newBreakTime = parseInt(breakTimeInput.value, 10);

                if (newFocusTime > 0 && newFocusTime <= 60) {
                    focusTime = newFocusTime;
                    localStorage.setItem('pomo.focusTime', focusTime);
                }
                
                if (newBreakTime > 0 && newBreakTime <= 30) {
                    breakTime = newBreakTime;
                    localStorage.setItem('pomo.breakTime', breakTime);
                }

                // íƒ€ì´ë¨¸ê°€ ì‘ë™ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ ì‹œê°„ ë¦¬ì…‹
                if (!isRunning) {
                    resetTimer(false); // UIë§Œ ë¦¬ì…‹
                    // í˜„ì¬ ëª¨ë“œì˜ totalTimeForModeë„ ì—…ë°ì´íŠ¸
                    totalTimeForMode = (currentMode === 'focus') ? focusTime * 60 : breakTime * 60;
                    updateProgressCircle(); // ì›í˜• ì§„í–‰ë°” ì´ˆê¸° ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
                }
                
                closeSettings();
            }


            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
            startPauseBtn.addEventListener('click', () => {
                if (isRunning) {
                    pauseTimer();
                } else {
                    startTimer();
                }
            });

            resetBtn.addEventListener('click', () => resetTimer(true));

            settingsBtn.addEventListener('click', openSettings);
            closeSettingsBtn.addEventListener('click', closeSettings);
            saveSettingsBtn.addEventListener('click', saveSettings);
            
            // ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) {
                    closeSettings();
                }
            });

            // --- ì´ˆê¸°í™” ---
            checkAndResetCount();
            updateTimerDisplay(); // ì´ˆê¸° í™”ë©´ì— ì›í˜• ì§„í–‰ë°”ë„ ì—…ë°ì´íŠ¸
        });
    </script>
</body>
</html>
